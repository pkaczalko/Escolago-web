<div class="singleBody">
  <div class="col1">
    <img class="okładka" src="{{ bookData.cover }}" alt="okładka" />
  </div>
  <div class="col2">
    <div class="col2.1">
      <div class="tytul">
        <p-card
          *ngIf="!editMode"
          header="{{ bookData.book_title }}"
          subheader="isbn: {{ bookData.isbn }}"
          styleClass="pcardHeader"
        >
          {{ bookData.authors }}
          <ng-template pTemplate="header">
            <div class="edytuj">
              <p-button
                (onClick)="editBookInfo()"
                label="Edytuj"
                icon="pi pi-file-edit"
                size="small"
              ></p-button>
            </div>
          </ng-template>
        </p-card>
        <p-card *ngIf="editMode" styleClass="pcardHeader">
          <div class="editBlock">
            <p>
              Tytuł:
              <input type="text" pInputText [(ngModel)]="edit.book_title" />
            </p>
            <p>
              ISBN: <input type="text" pInputText [(ngModel)]="edit.isbn" />
            </p>
            <p>
              Autor:
              <input type="text" pInputText [(ngModel)]="edit.authors" />
            </p>
          </div>
          <ng-template pTemplate="header">
            <div class="edytuj">
              <p-button
                [loading]="loading"
                (onClick)="saveChanges()"
                label="Zapisz"
                icon="pi pi-check"
                size="small"
                severity="success"
              ></p-button>
            </div>
          </ng-template>
        </p-card>
      </div>
    </div>

    <p-divider></p-divider>
    <div class="col2.2">
      <div class="info">
        <p-card header="Informacje">
          <p>
            Wydawnictwo: <b *ngIf="!editMode">{{ bookData.publisher }}</b>
            <input
              *ngIf="editMode"
              type="text"
              pInputText
              [(ngModel)]="edit.publisher"
            />
          </p>
          <p>
            Rok wydania: <b *ngIf="!editMode">{{ bookData.published_year }}</b>
            <input
              *ngIf="editMode"
              type="text"
              pInputText
              [(ngModel)]="edit.published_year"
            />
          </p>

          <p>
            Gatunek: <b *ngIf="!editMode">{{ bookData.genres }}</b>
            <input
              *ngIf="editMode"
              type="text"
              pInputText
              [(ngModel)]="edit.genres"
            />
          </p>
          <p>
            Stron: <b *ngIf="!editMode">{{ bookData.pages }}</b>
            <input
              *ngIf="editMode"
              type="text"
              pInputText
              [(ngModel)]="edit.pages"
            />
          </p>
          <p>
            Język: <b *ngIf="!editMode">{{ bookData.language | uppercase }}</b>
            <input
              *ngIf="editMode"
              type="text"
              pInputText
              [(ngModel)]="edit.language"
            />
          </p>
          <p>
            Typ: <b *ngIf="!editMode">{{ bookData.type }}</b>
            <input
              *ngIf="editMode"
              type="text"
              pInputText
              [(ngModel)]="edit.type"
            />
          </p>
          <p *ngIf="bookData.virtual">
            link:
            <a href="{{ bookData.copies[0].link }}">{{
              bookData.copies[0].link
            }}</a>
          </p>
          <p>
            Opis: <span *ngIf="!editMode">{{ bookData.description }}</span>
            <input
              *ngIf="editMode"
              type="text"
              pInputText
              [(ngModel)]="edit.description"
            />
          </p>
        </p-card>
      </div>
    </div>
    <p-divider></p-divider>
    <div class="col2.3">
      <div class="kopie">
        <p-card header="Dostępne egzemplarze" styleClass="pcardHeader">
          <p-table
            [value]="bookCopies"
            dataKey="id"
            [scrollable]="true"
            scrollHeight="400px"
            [tableStyle]="{ 'min-width': '50rem' }"
          >
            <ng-template pTemplate="header">
              <tr>
                <th>Nr inwentarza</th>
                <th>Stan</th>
                <th>Data dodania</th>
                <th>Akcje</th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-copy>
              <tr>
                <td>{{ copy.asset_id.id }}</td>
                <td>
                  <span *ngIf="copy.rented">
                    <div class="card flex justify-content-center">
                      <p-overlayPanel #op>
                        <p>
                          id użytkownika: <b>{{ copy.loan.user.id }}</b>
                        </p>
                        <p>
                          imię i nazwisko wypożyczającego:
                          <b
                            >{{ copy.loan.user.name }}
                            {{ copy.loan.user.surname }}</b
                          >
                        </p>
                        <p>
                          data wypożyczenia: <b>{{ copy.loan.dateOfRental }}</b>
                        </p>
                      </p-overlayPanel>
                      <p-button
                        size="small"
                        (click)="op.toggle($event)"
                        label="Wypożyczony"
                        [text]="true"
                        severity="danger"
                      ></p-button>
                    </div>
                  </span>
                  <span *ngIf="!copy.rented"
                    ><p-button
                      size="small"
                      label="Dostępny"
                      [disabled]="true"
                      [text]="true"
                      severity="success"
                    ></p-button
                  ></span>
                </td>
                <td>{{ copy.date_added }}</td>
                <td>
                  <span *ngIf="copy.rented"><button>zwróc</button></span>
                  <span *ngIf="!copy.rented"><button>wypożycz</button></span>
                  <button>usuń</button>
                </td>
              </tr>
            </ng-template>
          </p-table>

          <ng-template pTemplate="header">
            <div class="dodaj">
              <p-button
                (click)="addCopy()"
                label="Dodaj"
                severity="success"
                icon="pi pi-plus-circle"
                size="small"
              ></p-button>
            </div>
          </ng-template>
        </p-card>
      </div>
    </div>
  </div>
</div>
